<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Practice lab: Collaborative Filtering Recommender Systems &mdash; Machine Learning by Andrew Ng  documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link href="../../../../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            Machine Learning by Andrew Ng
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Supervised_Machine_Learning_Regression_and_Classification/Supervised.html">Supervised_Machine_Learning</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Machine Learning by Andrew Ng</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"> Practice lab: Collaborative Filtering Recommender Systems</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/source_files/Unsupervised_Learning_Recommenders_Reinforcement_Learning/week2/C3W2/C3W2A1/C3_W2_Collaborative_RecSys_Assignment.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="148adcecc3674157ab00fd3eb0304b02-Practice-lab:-Collaborative-Filtering-Recommender-Systems">
<h1><img alt="148adcecc3674157ab00fd3eb0304b02" src="../../../../../_images/movie_camera.png" /> Practice lab: Collaborative Filtering Recommender Systems<a class="headerlink" href="#148adcecc3674157ab00fd3eb0304b02-Practice-lab:-Collaborative-Filtering-Recommender-Systems" title="Permalink to this headline"></a></h1>
<p>In this exercise, you will implement collaborative filtering to build a recommender system for movies.</p>
</section>
<section id="0f47b1f82a454f4abcaa2514c5e90f8b-Outline">
<h1><img alt="0f47b1f82a454f4abcaa2514c5e90f8b" src="../../../../../_images/film_reel.png" /> Outline<a class="headerlink" href="#0f47b1f82a454f4abcaa2514c5e90f8b-Outline" title="Permalink to this headline"></a></h1>
<ul class="simple">
<li><p>1 - Notation</p></li>
<li><p>2 - Recommender Systems</p></li>
<li><p>3 - Movie ratings dataset</p></li>
<li><p>4 - Collaborative filtering learning algorithm</p>
<ul>
<li><p>4.1 Collaborative filtering cost function</p>
<ul>
<li><p>Exercise 1</p></li>
</ul>
</li>
</ul>
</li>
<li><p>5 - Learning movie recommendations</p></li>
<li><p>6 - Recommendations</p></li>
<li><p>7 - Congratulations!</p></li>
</ul>
<section id="Packages-cede5837f48f4442bb6220b1042ac8b1">
<h2>Packages <img alt="cede5837f48f4442bb6220b1042ac8b1" src="../../../../../_images/film_strip_vertical.png" /><a class="headerlink" href="#Packages-cede5837f48f4442bb6220b1042ac8b1" title="Permalink to this headline"></a></h2>
<p>We will use the now familiar NumPy and Tensorflow Packages.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="kn">from</span> <span class="nn">recsys_utils</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<p>## 1 - Notation</p>
<div class="line-block">
<div class="line">|General Notation | Description| Python (if any) | |:————-<a href="#id1"><span class="problematic" id="id2">|:------------------------------------------------------------|</span></a>| | <span class="math notranslate nohighlight">\(r(i,j)\)</span> | scalar; = 1 if user j rated game i = 0 otherwise || | <span class="math notranslate nohighlight">\(y(i,j)\)</span> | scalar; = rating given by user j on game i (if r(i,j) = 1 is defined) || |<span class="math notranslate nohighlight">\(\mathbf{w}^{(j)}\)</span> | vector; parameters for user j || |<span class="math notranslate nohighlight">\(b^{(j)}\)</span> | scalar; parameter for user j || | <span class="math notranslate nohighlight">\(\mathbf{x}^{(i)}\)</span> | vector; feature ratings for movie i
||</div>
<div class="line">| <span class="math notranslate nohighlight">\(n_u\)</span> | number of users |num_users| | <span class="math notranslate nohighlight">\(n_m\)</span> | number of movies | num_movies | | <span class="math notranslate nohighlight">\(n\)</span> | number of features | num_features | | <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> | matrix of vectors <span class="math notranslate nohighlight">\(\mathbf{x}^{(i)}\)</span> | X | | <span class="math notranslate nohighlight">\(\mathbf{W}\)</span> | matrix of vectors <span class="math notranslate nohighlight">\(\mathbf{w}^{(j)}\)</span> | W | | <span class="math notranslate nohighlight">\(\mathbf{b}\)</span> | vector of bias parameters <span class="math notranslate nohighlight">\(b^{(j)}\)</span> | b | | <span class="math notranslate nohighlight">\(\mathbf{R}\)</span> | matrix of elements <span class="math notranslate nohighlight">\(r(i,j)\)</span> | R |</div>
</div>
<p>## 2 - Recommender Systems <img alt="f0ffeba8f4be4d6fbfe6e58977fefc06" src="../../../../../_images/film_rating.png" /> In this lab, you will implement the collaborative filtering learning algorithm and apply it to a dataset of movie ratings. The goal of a collaborative filtering recommender system is to generate two vectors: For each user, a ‘parameter vector’ that embodies the movie tastes of a user. For each movie, a feature vector of the same size which embodies some description of the movie. The dot product of the two vectors plus the bias term
should produce an estimate of the rating the user might give to that movie.</p>
<p>The diagram below details how these vectors are learned.</p>
<figure><p><img alt="3560d3ea66124cdb8c9e7cdd28415965" src="../../../../../_images/ColabFilterLearn.PNG" /></p>
</figure><p>Existing ratings are provided in matrix form as shown. <span class="math notranslate nohighlight">\(Y\)</span> contains ratings; 0.5 to 5 inclusive in 0.5 steps. 0 if the movie has not been rated. <span class="math notranslate nohighlight">\(R\)</span> has a 1 where movies have been rated. Movies are in rows, users in columns. Each user has a parameter vector <span class="math notranslate nohighlight">\(w^{user}\)</span> and bias. Each movie has a feature vector <span class="math notranslate nohighlight">\(x^{movie}\)</span>. These vectors are simultaneously learned by using the existing user/movie ratings as training data. One training example is shown above:
<span class="math notranslate nohighlight">\(\mathbf{w}^{(1)} \cdot \mathbf{x}^{(1)} + b^{(1)} = 4\)</span>. It is worth noting that the feature vector <span class="math notranslate nohighlight">\(x^{movie}\)</span> must satisfy all the users while the user vector <span class="math notranslate nohighlight">\(w^{user}\)</span> must satisfy all the movies. This is the source of the name of this approach - all the users collaborate to generate the rating set.</p>
<figure><p><img alt="68af865613284588b84640d320cb7bad" src="../../../../../_images/ColabFilterUse.PNG" /></p>
</figure><p>Once the feature vectors and parameters are learned, they can be used to predict how a user might rate an unrated movie. This is shown in the diagram above. The equation is an example of predicting a rating for user one on movie zero.</p>
<p>In this exercise, you will implement the function <code class="docutils literal notranslate"><span class="pre">cofiCostFunc</span></code> that computes the collaborative filtering objective function. After implementing the objective function, you will use a TensorFlow custom training loop to learn the parameters for collaborative filtering. The first step is to detail the data set and data structures that will be used in the lab.</p>
<div class="line-block">
<div class="line-block">
<div class="line">## 3 - Movie ratings dataset <img alt="cc2e227ff5e6446e8021a254b809af1b" src="../../../../../_images/film_rating.png" /> The data set is derived from the <a class="reference external" href="https://grouplens.org/datasets/movielens/latest/">MovieLens “ml-latest-small”</a> dataset.</div>
</div>
<div class="line">[F. Maxwell Harper and Joseph A. Konstan. 2015. The MovieLens Datasets: History and Context. ACM Transactions on Interactive Intelligent Systems (TiiS) 5, 4: 19:1–19:19. <a class="reference external" href="https://doi.org/10.1145/2827872">https://doi.org/10.1145/2827872</a>]</div>
</div>
<p>The original dataset has 9000 movies rated by 600 users. The dataset has been reduced in size to focus on movies from the years since 2000. This dataset consists of ratings on a scale of 0.5 to 5 in 0.5 step increments. The reduced dataset has <span class="math notranslate nohighlight">\(n_u = 443\)</span> users, and <span class="math notranslate nohighlight">\(n_m= 4778\)</span> movies.</p>
<p>Below, you will load the movie dataset into the variables <span class="math notranslate nohighlight">\(Y\)</span> and <span class="math notranslate nohighlight">\(R\)</span>.</p>
<p>The matrix <span class="math notranslate nohighlight">\(Y\)</span> (a <span class="math notranslate nohighlight">\(n_m \times n_u\)</span> matrix) stores the ratings <span class="math notranslate nohighlight">\(y^{(i,j)}\)</span>. The matrix <span class="math notranslate nohighlight">\(R\)</span> is an binary-valued indicator matrix, where <span class="math notranslate nohighlight">\(R(i,j) = 1\)</span> if user <span class="math notranslate nohighlight">\(j\)</span> gave a rating to movie <span class="math notranslate nohighlight">\(i\)</span>, and <span class="math notranslate nohighlight">\(R(i,j)=0\)</span> otherwise.</p>
<p>Throughout this part of the exercise, you will also be working with the matrices, <span class="math notranslate nohighlight">\(\mathbf{X}\)</span>, <span class="math notranslate nohighlight">\(\mathbf{W}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{b}\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathbf{X} =
\begin{bmatrix}
--- (\mathbf{x}^{(0)})^T --- \\
--- (\mathbf{x}^{(1)})^T --- \\
\vdots \\
--- (\mathbf{x}^{(n_m-1)})^T --- \\
\end{bmatrix} , \quad
\mathbf{W} =
\begin{bmatrix}
--- (\mathbf{w}^{(0)})^T --- \\
--- (\mathbf{w}^{(1)})^T --- \\
\vdots \\
--- (\mathbf{w}^{(n_u-1)})^T --- \\
\end{bmatrix},\quad
\mathbf{ b} =
\begin{bmatrix}
 b^{(0)}  \\
 b^{(1)} \\
\vdots \\
b^{(n_u-1)} \\
\end{bmatrix}\quad\end{split}\]</div>
<p>The <span class="math notranslate nohighlight">\(i\)</span>-th row of <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> corresponds to the feature vector <span class="math notranslate nohighlight">\(x^{(i)}\)</span> for the <span class="math notranslate nohighlight">\(i\)</span>-th movie, and the <span class="math notranslate nohighlight">\(j\)</span>-th row of <span class="math notranslate nohighlight">\(\mathbf{W}\)</span> corresponds to one parameter vector <span class="math notranslate nohighlight">\(\mathbf{w}^{(j)}\)</span>, for the <span class="math notranslate nohighlight">\(j\)</span>-th user. Both <span class="math notranslate nohighlight">\(x^{(i)}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{w}^{(j)}\)</span> are <span class="math notranslate nohighlight">\(n\)</span>-dimensional vectors. For the purposes of this exercise, you will use <span class="math notranslate nohighlight">\(n=10\)</span>, and therefore, <span class="math notranslate nohighlight">\(\mathbf{x}^{(i)}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{w}^{(j)}\)</span> have 10 elements.
Correspondingly, <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> is a <span class="math notranslate nohighlight">\(n_m \times 10\)</span> matrix and <span class="math notranslate nohighlight">\(\mathbf{W}\)</span> is a <span class="math notranslate nohighlight">\(n_u \times 10\)</span> matrix.</p>
<div class="line-block">
<div class="line">We will start by loading the movie ratings dataset to understand the structure of the data. We will load <span class="math notranslate nohighlight">\(Y\)</span> and <span class="math notranslate nohighlight">\(R\)</span> with the movie dataset.</div>
<div class="line">We’ll also load <span class="math notranslate nohighlight">\(\mathbf{X}\)</span>, <span class="math notranslate nohighlight">\(\mathbf{W}\)</span>, and <span class="math notranslate nohighlight">\(\mathbf{b}\)</span> with pre-computed values. These values will be learned later in the lab, but we’ll use pre-computed values to develop the cost model.</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Load data</span>
<span class="n">X</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">num_movies</span><span class="p">,</span> <span class="n">num_features</span><span class="p">,</span> <span class="n">num_users</span> <span class="o">=</span> <span class="n">load_precalc_params_small</span><span class="p">()</span>
<span class="n">Y</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">load_ratings_small</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;num_features&quot;</span><span class="p">,</span> <span class="n">num_features</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;num_movies&quot;</span><span class="p">,</span>   <span class="n">num_movies</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;num_users&quot;</span><span class="p">,</span>    <span class="n">num_users</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Y (4778, 443) R (4778, 443)
X (4778, 10)
W (443, 10)
b (1, 443)
num_features 10
num_movies 4778
num_users 443
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  From the matrix, we can compute statistics like average rating.</span>
<span class="n">tsmean</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average rating for movie 1 : </span><span class="si">{</span><span class="n">tsmean</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2"> / 5&quot;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Average rating for movie 1 : 3.400 / 5
</pre></div></div>
</div>
<p>## 4 - Collaborative filtering learning algorithm <img alt="70eaba34b73b4c2b8311f8a8cc6b57a4" src="../../../../../_images/film_filter.png" /></p>
<p>Now, you will begin implementing the collaborative filtering learning algorithm. You will start by implementing the objective function.</p>
<p>The collaborative filtering algorithm in the setting of movie recommendations considers a set of <span class="math notranslate nohighlight">\(n\)</span>-dimensional parameter vectors <span class="math notranslate nohighlight">\(\mathbf{x}^{(0)},...,\mathbf{x}^{(n_m-1)}\)</span>, <span class="math notranslate nohighlight">\(\mathbf{w}^{(0)},...,\mathbf{w}^{(n_u-1)}\)</span> and <span class="math notranslate nohighlight">\(b^{(0)},...,b^{(n_u-1)}\)</span>, where the model predicts the rating for movie <span class="math notranslate nohighlight">\(i\)</span> by user <span class="math notranslate nohighlight">\(j\)</span> as <span class="math notranslate nohighlight">\(y^{(i,j)} = \mathbf{w}^{(j)}\cdot \mathbf{x}^{(i)} + b^{(i)}\)</span> . Given a dataset that consists of a set of ratings produced by some users on
some movies, you wish to learn the parameter vectors <span class="math notranslate nohighlight">\(\mathbf{x}^{(0)},...,\mathbf{x}^{(n_m-1)}, \mathbf{w}^{(0)},...,\mathbf{w}^{(n_u-1)}\)</span> and <span class="math notranslate nohighlight">\(b^{(0)},...,b^{(n_u-1)}\)</span> that produce the best fit (minimizes the squared error).</p>
<p>You will complete the code in cofiCostFunc to compute the cost function for collaborative filtering.</p>
<p>### 4.1 Collaborative filtering cost function</p>
<p>The collaborative filtering cost function is given by</p>
<div class="math notranslate nohighlight">
\[J({\mathbf{x}^{(0)},...,\mathbf{x}^{(n_m-1)},\mathbf{w}^{(0)},b^{(0)},...,\mathbf{w}^{(n_u-1)},b^{(n_u-1)}})= \frac{1}{2}\sum_{(i,j):r(i,j)=1}(\mathbf{w}^{(j)} \cdot \mathbf{x}^{(i)} + b^{(j)} - y^{(i,j)})^2
+\underbrace{
\frac{\lambda}{2}
\sum_{j=0}^{n_u-1}\sum_{k=0}^{n-1}(\mathbf{w}^{(j)}_k)^2
+ \frac{\lambda}{2}\sum_{i=0}^{n_m-1}\sum_{k=0}^{n-1}(\mathbf{x}_k^{(i)})^2
}_{regularization}
\tag{1}\]</div>
<p>The first summation in (1) is “for all <span class="math notranslate nohighlight">\(i\)</span>, <span class="math notranslate nohighlight">\(j\)</span> where <span class="math notranslate nohighlight">\(r(i,j)\)</span> equals <span class="math notranslate nohighlight">\(1\)</span>” and could be written:</p>
<div class="math notranslate nohighlight">
\[= \frac{1}{2}\sum_{j=0}^{n_u-1} \sum_{i=0}^{n_m-1}r(i,j)*(\mathbf{w}^{(j)} \cdot \mathbf{x}^{(i)} + b^{(j)} - y^{(i,j)})^2
+\text{regularization}\]</div>
<p>You should now write cofiCostFunc (collaborative filtering cost function) to return this cost.</p>
<p>### Exercise 1</p>
<div class="line-block">
<div class="line"><strong>For loop Implementation:</strong></div>
<div class="line">Start by implementing the cost function using for loops. Consider developing the cost function in two steps. First, develop the cost function without regularization. A test case that does not include regularization is provided below to test your implementation. Once that is working, add regularization and run the tests that include regularization. Note that you should be accumulating the cost for user <span class="math notranslate nohighlight">\(j\)</span> and movie <span class="math notranslate nohighlight">\(i\)</span> only if <span class="math notranslate nohighlight">\(R(i,j) = 1\)</span>.</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># GRADED FUNCTION: cofi_cost_func</span>
<span class="c1"># UNQ_C1</span>

<span class="k">def</span> <span class="nf">cofi_cost_func</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">lambda_</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the cost for the content-based filtering</span>
<span class="sd">    Args:</span>
<span class="sd">      X (ndarray (num_movies,num_features)): matrix of item features</span>
<span class="sd">      W (ndarray (num_users,num_features)) : matrix of user parameters</span>
<span class="sd">      b (ndarray (1, num_users)            : vector of user parameters</span>
<span class="sd">      Y (ndarray (num_movies,num_users)    : matrix of user ratings of movies</span>
<span class="sd">      R (ndarray (num_movies,num_users)    : matrix, where R(i, j) = 1 if the i-th movies was rated by the j-th user</span>
<span class="sd">      lambda_ (float): regularization parameter</span>
<span class="sd">    Returns:</span>
<span class="sd">      J (float) : Cost</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nm</span><span class="p">,</span> <span class="n">nu</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">J</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">### START CODE HERE ###</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nu</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">W</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span>
        <span class="n">b_j</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nm</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
            <span class="n">J</span> <span class="o">+=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">b_j</span> <span class="o">-</span> <span class="n">y</span> <span class="p">))</span>
    <span class="n">J</span> <span class="o">+=</span> <span class="p">(</span><span class="n">lambda_</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">W</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">X</span><span class="p">)))</span>
    <span class="n">J</span> <span class="o">=</span> <span class="n">J</span><span class="o">/</span><span class="mi">2</span>
    <span class="c1">### END CODE HERE ###</span>

    <span class="k">return</span> <span class="n">J</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Public tests</span>
<span class="kn">from</span> <span class="nn">public_tests</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">test_cofi_cost_func</span><span class="p">(</span><span class="n">cofi_cost_func</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-green-intense-fg">All tests passed!</span>
</pre></div></div>
</div>
<details><div class="line-block">
<div class="line">Click for hints You can structure the code in two for loops similar to the summation in (1).</div>
<div class="line">Implement the code without regularization first.</div>
<div class="line">Note that some of the elements in (1) are vectors. Use np.dot(). You can also use np.square(). Pay close attention to which elements are indexed by i and which are indexed by j. Don’t forget to divide by two.</div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">### START CODE HERE ###</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nu</span><span class="p">):</span>


    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nm</span><span class="p">):</span>


<span class="c1">### END CODE HERE ###</span>
</pre></div>
</div>
<details><p>Click for more hints</p>
<div class="line-block">
<div class="line">Here is some more details. The code below pulls out each element from the matrix before using it. One could also reference the matrix directly.</div>
<div class="line">This code does not contain regularization.</div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nm</span><span class="p">,</span><span class="n">nu</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">shape</span>
<span class="n">J</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1">### START CODE HERE ###</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nu</span><span class="p">):</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">W</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span>
    <span class="n">b_j</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nm</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span>
        <span class="n">y</span> <span class="o">=</span>
        <span class="n">r</span> <span class="o">=</span>
        <span class="n">J</span> <span class="o">+=</span>
<span class="n">J</span> <span class="o">=</span> <span class="n">J</span><span class="o">/</span><span class="mi">2</span>
<span class="c1">### END CODE HERE ###</span>
</pre></div>
</div>
<details><p>Last Resort (full non-regularized implementation)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nm</span><span class="p">,</span><span class="n">nu</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">shape</span>
<span class="n">J</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1">### START CODE HERE ###</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nu</span><span class="p">):</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">W</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span>
    <span class="n">b_j</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nm</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
        <span class="n">J</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">b_j</span> <span class="o">-</span> <span class="n">y</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">J</span> <span class="o">=</span> <span class="n">J</span><span class="o">/</span><span class="mi">2</span>
<span class="c1">### END CODE HERE ###</span>
</pre></div>
</div>
<details><p>regularization Regularization just squares each element of the W array and X array and them sums all the squared elements. You can utilize np.square() and np.sum().</p>
<details><p>regularization details</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">J</span> <span class="o">+=</span> <span class="n">lambda_</span><span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">W</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">X</span><span class="p">)))</span>
</pre></div>
</div>
</details></details></details></details><div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reduce the data set size so that this runs faster</span>
<span class="n">num_users_r</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">num_movies_r</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">num_features_r</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">X_r</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">num_movies_r</span><span class="p">,</span> <span class="p">:</span><span class="n">num_features_r</span><span class="p">]</span>
<span class="n">W_r</span> <span class="o">=</span> <span class="n">W</span><span class="p">[:</span><span class="n">num_users_r</span><span class="p">,</span>  <span class="p">:</span><span class="n">num_features_r</span><span class="p">]</span>
<span class="n">b_r</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="n">num_users_r</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Y_r</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[:</span><span class="n">num_movies_r</span><span class="p">,</span> <span class="p">:</span><span class="n">num_users_r</span><span class="p">]</span>
<span class="n">R_r</span> <span class="o">=</span> <span class="n">R</span><span class="p">[:</span><span class="n">num_movies_r</span><span class="p">,</span> <span class="p">:</span><span class="n">num_users_r</span><span class="p">]</span>

<span class="c1"># Evaluate cost function</span>
<span class="n">J</span> <span class="o">=</span> <span class="n">cofi_cost_func</span><span class="p">(</span><span class="n">X_r</span><span class="p">,</span> <span class="n">W_r</span><span class="p">,</span> <span class="n">b_r</span><span class="p">,</span> <span class="n">Y_r</span><span class="p">,</span> <span class="n">R_r</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cost: </span><span class="si">{</span><span class="n">J</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Cost: 13.67
</pre></div></div>
</div>
<div class="line-block">
<div class="line"><strong>Expected Output (lambda = 0)</strong>:</div>
<div class="line"><span class="math notranslate nohighlight">\(13.67\)</span>.</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evaluate cost function with regularization</span>
<span class="n">J</span> <span class="o">=</span> <span class="n">cofi_cost_func</span><span class="p">(</span><span class="n">X_r</span><span class="p">,</span> <span class="n">W_r</span><span class="p">,</span> <span class="n">b_r</span><span class="p">,</span> <span class="n">Y_r</span><span class="p">,</span> <span class="n">R_r</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">);</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cost (with regularization): </span><span class="si">{</span><span class="n">J</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Cost (with regularization): 28.09
</pre></div></div>
</div>
<p><strong>Expected Output</strong>:</p>
<p>28.09</p>
<p><strong>Vectorized Implementation</strong></p>
<p>It is important to create a vectorized implementation to compute <span class="math notranslate nohighlight">\(J\)</span>, since it will later be called many times during optimization. The linear algebra utilized is not the focus of this series, so the implementation is provided. If you are an expert in linear algebra, feel free to create your version without referencing the code below.</p>
<p>Run the code below and verify that it produces the same results as the non-vectorized version.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cofi_cost_func_v</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">lambda_</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the cost for the content-based filtering</span>
<span class="sd">    Vectorized for speed. Uses tensorflow operations to be compatible with custom training loop.</span>
<span class="sd">    Args:</span>
<span class="sd">      X (ndarray (num_movies,num_features)): matrix of item features</span>
<span class="sd">      W (ndarray (num_users,num_features)) : matrix of user parameters</span>
<span class="sd">      b (ndarray (1, num_users)            : vector of user parameters</span>
<span class="sd">      Y (ndarray (num_movies,num_users)    : matrix of user ratings of movies</span>
<span class="sd">      R (ndarray (num_movies,num_users)    : matrix, where R(i, j) = 1 if the i-th movies was rated by the j-th user</span>
<span class="sd">      lambda_ (float): regularization parameter</span>
<span class="sd">    Returns:</span>
<span class="sd">      J (float) : Cost</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">W</span><span class="p">))</span> <span class="o">+</span> <span class="n">b</span> <span class="o">-</span> <span class="n">Y</span><span class="p">)</span><span class="o">*</span><span class="n">R</span>
    <span class="n">J</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">j</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">lambda_</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">W</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">J</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evaluate cost function</span>
<span class="n">J</span> <span class="o">=</span> <span class="n">cofi_cost_func_v</span><span class="p">(</span><span class="n">X_r</span><span class="p">,</span> <span class="n">W_r</span><span class="p">,</span> <span class="n">b_r</span><span class="p">,</span> <span class="n">Y_r</span><span class="p">,</span> <span class="n">R_r</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cost: </span><span class="si">{</span><span class="n">J</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Evaluate cost function with regularization</span>
<span class="n">J</span> <span class="o">=</span> <span class="n">cofi_cost_func_v</span><span class="p">(</span><span class="n">X_r</span><span class="p">,</span> <span class="n">W_r</span><span class="p">,</span> <span class="n">b_r</span><span class="p">,</span> <span class="n">Y_r</span><span class="p">,</span> <span class="n">R_r</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">);</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cost (with regularization): </span><span class="si">{</span><span class="n">J</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Cost: 13.67
Cost (with regularization): 28.09
</pre></div></div>
</div>
<div class="line-block">
<div class="line"><strong>Expected Output</strong>:</div>
<div class="line">Cost: 13.67</div>
<div class="line">Cost (with regularization): 28.09</div>
</div>
<p>## 5 - Learning movie recommendations <img alt="ea6c2f0d1c6149e4aa0b76db036d43da" src="../../../../../_images/film_man_action.png" /> ——————————</p>
<p>After you have finished implementing the collaborative filtering cost function, you can start training your algorithm to make movie recommendations for yourself.</p>
<p>In the cell below, you can enter your own movie choices. The algorithm will then make recommendations for you! We have filled out some values according to our preferences, but after you have things working with our choices, you should change this to match your tastes. A list of all movies in the dataset is in the file <a class="reference external" href="data/small_movie_list.csv">movie list</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">movieList</span><span class="p">,</span> <span class="n">movieList_df</span> <span class="o">=</span> <span class="n">load_Movie_List_pd</span><span class="p">()</span>

<span class="n">my_ratings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_movies</span><span class="p">)</span>          <span class="c1">#  Initialize my ratings</span>

<span class="c1"># Check the file small_movie_list.csv for id of each movie in our dataset</span>
<span class="c1"># For example, Toy Story 3 (2010) has ID 2700, so to rate it &quot;5&quot;, you can set</span>
<span class="n">my_ratings</span><span class="p">[</span><span class="mi">2700</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1">#Or suppose you did not enjoy Persuasion (2007), you can set</span>
<span class="n">my_ratings</span><span class="p">[</span><span class="mi">2609</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="c1"># We have selected a few movies we liked / did not like and the ratings we</span>
<span class="c1"># gave are as follows:</span>
<span class="n">my_ratings</span><span class="p">[</span><span class="mi">929</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">5</span>   <span class="c1"># Lord of the Rings: The Return of the King, The</span>
<span class="n">my_ratings</span><span class="p">[</span><span class="mi">246</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">5</span>   <span class="c1"># Shrek (2001)</span>
<span class="n">my_ratings</span><span class="p">[</span><span class="mi">2716</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>   <span class="c1"># Inception</span>
<span class="n">my_ratings</span><span class="p">[</span><span class="mi">1150</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>   <span class="c1"># Incredibles, The (2004)</span>
<span class="n">my_ratings</span><span class="p">[</span><span class="mi">382</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">2</span>   <span class="c1"># Amelie (Fabuleux destin d&#39;Amélie Poulain, Le)</span>
<span class="n">my_ratings</span><span class="p">[</span><span class="mi">366</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">5</span>   <span class="c1"># Harry Potter and the Sorcerer&#39;s Stone (a.k.a. Harry Potter and the Philosopher&#39;s Stone) (2001)</span>
<span class="n">my_ratings</span><span class="p">[</span><span class="mi">622</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">5</span>   <span class="c1"># Harry Potter and the Chamber of Secrets (2002)</span>
<span class="n">my_ratings</span><span class="p">[</span><span class="mi">988</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">3</span>   <span class="c1"># Eternal Sunshine of the Spotless Mind (2004)</span>
<span class="n">my_ratings</span><span class="p">[</span><span class="mi">2925</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>   <span class="c1"># Louis Theroux: Law &amp; Disorder (2008)</span>
<span class="n">my_ratings</span><span class="p">[</span><span class="mi">2937</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>   <span class="c1"># Nothing to Declare (Rien à déclarer)</span>
<span class="n">my_ratings</span><span class="p">[</span><span class="mi">793</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">5</span>   <span class="c1"># Pirates of the Caribbean: The Curse of the Black Pearl (2003)</span>
<span class="n">my_rated</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">my_ratings</span><span class="p">))</span> <span class="k">if</span> <span class="n">my_ratings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">New user ratings:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">my_ratings</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">my_ratings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rated </span><span class="si">{</span><span class="n">my_ratings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> for  </span><span class="si">{</span><span class="n">movieList_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s2">&quot;title&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

New user ratings:

Rated 5.0 for  Shrek (2001)
Rated 5.0 for  Harry Potter and the Sorcerer&#39;s Stone (a.k.a. Harry Potter and the Philosopher&#39;s Stone) (2001)
Rated 2.0 for  Amelie (Fabuleux destin d&#39;Amélie Poulain, Le) (2001)
Rated 5.0 for  Harry Potter and the Chamber of Secrets (2002)
Rated 5.0 for  Pirates of the Caribbean: The Curse of the Black Pearl (2003)
Rated 5.0 for  Lord of the Rings: The Return of the King, The (2003)
Rated 3.0 for  Eternal Sunshine of the Spotless Mind (2004)
Rated 5.0 for  Incredibles, The (2004)
Rated 2.0 for  Persuasion (2007)
Rated 5.0 for  Toy Story 3 (2010)
Rated 3.0 for  Inception (2010)
Rated 1.0 for  Louis Theroux: Law &amp; Disorder (2008)
Rated 1.0 for  Nothing to Declare (Rien à déclarer) (2010)
</pre></div></div>
</div>
<p>Now, let’s add these reviews to <span class="math notranslate nohighlight">\(Y\)</span> and <span class="math notranslate nohighlight">\(R\)</span> and normalize the ratings.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reload ratings and add new ratings</span>
<span class="n">Y</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">load_ratings_small</span><span class="p">()</span>
<span class="n">Y</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">my_ratings</span><span class="p">,</span> <span class="n">Y</span><span class="p">]</span>
<span class="n">R</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[(</span><span class="n">my_ratings</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">R</span><span class="p">]</span>

<span class="c1"># Normalize the Dataset</span>
<span class="n">Ynorm</span><span class="p">,</span> <span class="n">Ymean</span> <span class="o">=</span> <span class="n">normalizeRatings</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let’s prepare to train the model. Initialize the parameters and select the Adam optimizer.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#  Useful Values</span>
<span class="n">num_movies</span><span class="p">,</span> <span class="n">num_users</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">shape</span>
<span class="n">num_features</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># Set Initial Parameters (W, X), use tf.Variable to track these variables</span>
<span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span> <span class="c1"># for consistent results</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">((</span><span class="n">num_users</span><span class="p">,</span>  <span class="n">num_features</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">((</span><span class="n">num_movies</span><span class="p">,</span> <span class="n">num_features</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span>          <span class="n">num_users</span><span class="p">),</span>   <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="c1"># Instantiate an optimizer.</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let’s now train the collaborative filtering model. This will learn the parameters <span class="math notranslate nohighlight">\(\mathbf{X}\)</span>, <span class="math notranslate nohighlight">\(\mathbf{W}\)</span>, and <span class="math notranslate nohighlight">\(\mathbf{b}\)</span>.</p>
<p>The operations involved in learning <span class="math notranslate nohighlight">\(w\)</span>, <span class="math notranslate nohighlight">\(b\)</span>, and <span class="math notranslate nohighlight">\(x\)</span> simultaneously do not fall into the typical ‘layers’ offered in the TensorFlow neural network package. Consequently, the flow used in Course 2: Model, Compile(), Fit(), Predict(), are not directly applicable. Instead, we can use a custom training loop.</p>
<p>Recall from earlier labs the steps of gradient descent. - repeat until convergence: - compute forward pass - compute the derivatives of the loss relative to parameters - update the parameters using the learning rate and the computed derivatives</p>
<p>TensorFlow has the marvelous capability of calculating the derivatives for you. This is shown below. Within the <code class="docutils literal notranslate"><span class="pre">tf.GradientTape()</span></code> section, operations on Tensorflow Variables are tracked. When <code class="docutils literal notranslate"><span class="pre">tape.gradient()</span></code> is later called, it will return the gradient of the loss relative to the tracked variables. The gradients can then be applied to the parameters using an optimizer. This is a very brief introduction to a useful feature of TensorFlow and other machine learning frameworks. Further
information can be found by investigating “custom training loops” within the framework of interest.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iterations</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">lambda_</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
    <span class="c1"># Use TensorFlow’s GradientTape</span>
    <span class="c1"># to record the operations used to compute the cost</span>
    <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">GradientTape</span><span class="p">()</span> <span class="k">as</span> <span class="n">tape</span><span class="p">:</span>

        <span class="c1"># Compute the cost (forward pass included in cost)</span>
        <span class="n">cost_value</span> <span class="o">=</span> <span class="n">cofi_cost_func_v</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">Ynorm</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">lambda_</span><span class="p">)</span>

    <span class="c1"># Use the gradient tape to automatically retrieve</span>
    <span class="c1"># the gradients of the trainable variables with respect to the loss</span>
    <span class="n">grads</span> <span class="o">=</span> <span class="n">tape</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span> <span class="n">cost_value</span><span class="p">,</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span><span class="n">W</span><span class="p">,</span><span class="n">b</span><span class="p">]</span> <span class="p">)</span>

    <span class="c1"># Run one step of gradient descent by updating</span>
    <span class="c1"># the value of the variables to minimize the loss.</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">apply_gradients</span><span class="p">(</span> <span class="nb">zip</span><span class="p">(</span><span class="n">grads</span><span class="p">,</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span><span class="n">W</span><span class="p">,</span><span class="n">b</span><span class="p">])</span> <span class="p">)</span>

    <span class="c1"># Log periodically.</span>
    <span class="k">if</span> <span class="nb">iter</span> <span class="o">%</span> <span class="mi">20</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training loss at iteration </span><span class="si">{</span><span class="nb">iter</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">cost_value</span><span class="si">:</span><span class="s2">0.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Training loss at iteration 0: 2321191.3
Training loss at iteration 20: 136168.7
Training loss at iteration 40: 51863.3
Training loss at iteration 60: 24598.8
Training loss at iteration 80: 13630.4
Training loss at iteration 100: 8487.6
Training loss at iteration 120: 5807.7
Training loss at iteration 140: 4311.6
Training loss at iteration 160: 3435.2
Training loss at iteration 180: 2902.1
</pre></div></div>
</div>
<p>## 6 - Recommendations Below, we compute the ratings for all the movies and users and display the movies that are recommended. These are based on the movies and ratings entered as <code class="docutils literal notranslate"><span class="pre">my_ratings[]</span></code> above. To predict the rating of movie <span class="math notranslate nohighlight">\(i\)</span> for user <span class="math notranslate nohighlight">\(j\)</span>, you compute <span class="math notranslate nohighlight">\(\mathbf{w}^{(j)} \cdot \mathbf{x}^{(i)} + b^{(j)}\)</span>. This can be computed for all ratings using matrix multiplication.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a prediction using trained weights and biases</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">numpy</span><span class="p">()))</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

<span class="c1">#restore the mean</span>
<span class="n">pm</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">Ymean</span>

<span class="n">my_predictions</span> <span class="o">=</span> <span class="n">pm</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># sort predictions</span>
<span class="n">ix</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">my_predictions</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;DESCENDING&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">17</span><span class="p">):</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">ix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">my_rated</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Predicting rating </span><span class="si">{</span><span class="n">my_predictions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1"> for movie </span><span class="si">{</span><span class="n">movieList</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Original vs Predicted ratings:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">my_ratings</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">my_ratings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Original </span><span class="si">{</span><span class="n">my_ratings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">, Predicted </span><span class="si">{</span><span class="n">my_predictions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1"> for </span><span class="si">{</span><span class="n">movieList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Predicting rating 4.49 for movie My Sassy Girl (Yeopgijeogin geunyeo) (2001)
Predicting rating 4.48 for movie Martin Lawrence Live: Runteldat (2002)
Predicting rating 4.48 for movie Memento (2000)
Predicting rating 4.47 for movie Delirium (2014)
Predicting rating 4.47 for movie Laggies (2014)
Predicting rating 4.47 for movie One I Love, The (2014)
Predicting rating 4.46 for movie Particle Fever (2013)
Predicting rating 4.45 for movie Eichmann (2007)
Predicting rating 4.45 for movie Battle Royale 2: Requiem (Batoru rowaiaru II: Chinkonka) (2003)
Predicting rating 4.45 for movie Into the Abyss (2011)


Original vs Predicted ratings:

Original 5.0, Predicted 4.90 for Shrek (2001)
Original 5.0, Predicted 4.84 for Harry Potter and the Sorcerer&#39;s Stone (a.k.a. Harry Potter and the Philosopher&#39;s Stone) (2001)
Original 2.0, Predicted 2.13 for Amelie (Fabuleux destin d&#39;Amélie Poulain, Le) (2001)
Original 5.0, Predicted 4.88 for Harry Potter and the Chamber of Secrets (2002)
Original 5.0, Predicted 4.87 for Pirates of the Caribbean: The Curse of the Black Pearl (2003)
Original 5.0, Predicted 4.89 for Lord of the Rings: The Return of the King, The (2003)
Original 3.0, Predicted 3.00 for Eternal Sunshine of the Spotless Mind (2004)
Original 5.0, Predicted 4.90 for Incredibles, The (2004)
Original 2.0, Predicted 2.11 for Persuasion (2007)
Original 5.0, Predicted 4.80 for Toy Story 3 (2010)
Original 3.0, Predicted 3.00 for Inception (2010)
Original 1.0, Predicted 1.41 for Louis Theroux: Law &amp; Disorder (2008)
Original 1.0, Predicted 1.26 for Nothing to Declare (Rien à déclarer) (2010)
</pre></div></div>
</div>
<p>In practice, additional information can be utilized to enhance our predictions. Above, the predicted ratings for the first few hundred movies lie in a small range. We can augment the above by selecting from those top movies, movies that have high average ratings and movies with more than 20 ratings. This section uses a <a class="reference external" href="https://pandas.pydata.org/">Pandas</a> data frame which has many handy sorting features.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">filter</span><span class="o">=</span><span class="p">(</span><span class="n">movieList_df</span><span class="p">[</span><span class="s2">&quot;number of ratings&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">movieList_df</span><span class="p">[</span><span class="s2">&quot;pred&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_predictions</span>
<span class="n">movieList_df</span> <span class="o">=</span> <span class="n">movieList_df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pred&quot;</span><span class="p">,</span> <span class="s2">&quot;mean rating&quot;</span><span class="p">,</span> <span class="s2">&quot;number of ratings&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">])</span>
<span class="n">movieList_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ix</span><span class="p">[:</span><span class="mi">300</span><span class="p">]]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">filter</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;mean rating&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pred</th>
      <th>mean rating</th>
      <th>number of ratings</th>
      <th>title</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1743</th>
      <td>4.030965</td>
      <td>4.252336</td>
      <td>107</td>
      <td>Departed, The (2006)</td>
    </tr>
    <tr>
      <th>2112</th>
      <td>3.985287</td>
      <td>4.238255</td>
      <td>149</td>
      <td>Dark Knight, The (2008)</td>
    </tr>
    <tr>
      <th>211</th>
      <td>4.477792</td>
      <td>4.122642</td>
      <td>159</td>
      <td>Memento (2000)</td>
    </tr>
    <tr>
      <th>929</th>
      <td>4.887053</td>
      <td>4.118919</td>
      <td>185</td>
      <td>Lord of the Rings: The Return of the King, The...</td>
    </tr>
    <tr>
      <th>2700</th>
      <td>4.796530</td>
      <td>4.109091</td>
      <td>55</td>
      <td>Toy Story 3 (2010)</td>
    </tr>
    <tr>
      <th>653</th>
      <td>4.357304</td>
      <td>4.021277</td>
      <td>188</td>
      <td>Lord of the Rings: The Two Towers, The (2002)</td>
    </tr>
    <tr>
      <th>1122</th>
      <td>4.004469</td>
      <td>4.006494</td>
      <td>77</td>
      <td>Shaun of the Dead (2004)</td>
    </tr>
    <tr>
      <th>1841</th>
      <td>3.980647</td>
      <td>4.000000</td>
      <td>61</td>
      <td>Hot Fuzz (2007)</td>
    </tr>
    <tr>
      <th>3083</th>
      <td>4.084633</td>
      <td>3.993421</td>
      <td>76</td>
      <td>Dark Knight Rises, The (2012)</td>
    </tr>
    <tr>
      <th>2804</th>
      <td>4.434171</td>
      <td>3.989362</td>
      <td>47</td>
      <td>Harry Potter and the Deathly Hallows: Part 1 (...</td>
    </tr>
    <tr>
      <th>773</th>
      <td>4.289679</td>
      <td>3.960993</td>
      <td>141</td>
      <td>Finding Nemo (2003)</td>
    </tr>
    <tr>
      <th>1771</th>
      <td>4.344993</td>
      <td>3.944444</td>
      <td>81</td>
      <td>Casino Royale (2006)</td>
    </tr>
    <tr>
      <th>2649</th>
      <td>4.133482</td>
      <td>3.943396</td>
      <td>53</td>
      <td>How to Train Your Dragon (2010)</td>
    </tr>
    <tr>
      <th>2455</th>
      <td>4.175746</td>
      <td>3.887931</td>
      <td>58</td>
      <td>Harry Potter and the Half-Blood Prince (2009)</td>
    </tr>
    <tr>
      <th>361</th>
      <td>4.135291</td>
      <td>3.871212</td>
      <td>132</td>
      <td>Monsters, Inc. (2001)</td>
    </tr>
    <tr>
      <th>3014</th>
      <td>3.967901</td>
      <td>3.869565</td>
      <td>69</td>
      <td>Avengers, The (2012)</td>
    </tr>
    <tr>
      <th>246</th>
      <td>4.897137</td>
      <td>3.867647</td>
      <td>170</td>
      <td>Shrek (2001)</td>
    </tr>
    <tr>
      <th>151</th>
      <td>3.971888</td>
      <td>3.836364</td>
      <td>110</td>
      <td>Crouching Tiger, Hidden Dragon (Wo hu cang lon...</td>
    </tr>
    <tr>
      <th>1150</th>
      <td>4.898892</td>
      <td>3.836000</td>
      <td>125</td>
      <td>Incredibles, The (2004)</td>
    </tr>
    <tr>
      <th>793</th>
      <td>4.874935</td>
      <td>3.778523</td>
      <td>149</td>
      <td>Pirates of the Caribbean: The Curse of the Bla...</td>
    </tr>
    <tr>
      <th>366</th>
      <td>4.843375</td>
      <td>3.761682</td>
      <td>107</td>
      <td>Harry Potter and the Sorcerer's Stone (a.k.a. ...</td>
    </tr>
    <tr>
      <th>754</th>
      <td>4.021774</td>
      <td>3.723684</td>
      <td>76</td>
      <td>X2: X-Men United (2003)</td>
    </tr>
    <tr>
      <th>79</th>
      <td>4.242984</td>
      <td>3.699248</td>
      <td>133</td>
      <td>X-Men (2000)</td>
    </tr>
    <tr>
      <th>622</th>
      <td>4.878342</td>
      <td>3.598039</td>
      <td>102</td>
      <td>Harry Potter and the Chamber of Secrets (2002)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>## 7 - Congratulations! <img alt="b790e4a206e845aa806d6363eede7bce" src="../../../../../_images/film_award.png" /> You have implemented a useful recommender system!</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Andrew Ng.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>