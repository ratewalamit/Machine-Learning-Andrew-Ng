<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Anomaly Detection &mdash; Machine Learning by Andrew Ng  documentation</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link href="../../../../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            Machine Learning by Andrew Ng
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Supervised_Machine_Learning_Regression_and_Classification/Supervised.html">Supervised_Machine_Learning</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Machine Learning by Andrew Ng</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Anomaly Detection</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/source_files/Unsupervised_Learning_Recommenders_Reinforcement_Learning/week1/C3W1A/C3W1A2/C3_W1_Anomaly_Detection.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Anomaly-Detection">
<h1>Anomaly Detection<a class="headerlink" href="#Anomaly-Detection" title="Permalink to this heading"></a></h1>
<p>In this exercise, you will implement the anomaly detection algorithm and apply it to detect failing servers on a network.</p>
</section>
<section id="Outline">
<h1>Outline<a class="headerlink" href="#Outline" title="Permalink to this heading"></a></h1>
<ul class="simple">
<li><p>1 - Packages</p></li>
<li><p>2 - Anomaly detection</p>
<ul>
<li><p>2.1 Problem Statement</p></li>
<li><p>2.2 Dataset</p></li>
<li><p>2.3 Gaussian distribution</p>
<ul>
<li><p>Exercise 1</p></li>
<li><p>Exercise 2</p></li>
</ul>
</li>
<li><p>2.4 High dimensional dataset</p></li>
</ul>
</li>
</ul>
<p>## 1 - Packages</p>
<p>First, let’s run the cell below to import all the packages that you will need during this assignment. - <a class="reference external" href="www.numpy.org">numpy</a> is the fundamental package for working with matrices in Python. - <a class="reference external" href="http://matplotlib.org">matplotlib</a> is a famous library to plot graphs in Python. - <code class="docutils literal notranslate"><span class="pre">utils.py</span></code> contains helper functions for this assignment. You do not need to modify code in this file.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<p>## 2 - Anomaly detection</p>
<p>### 2.1 Problem Statement</p>
<p>In this exercise, you will implement an anomaly detection algorithm to detect anomalous behavior in server computers.</p>
<p>The dataset contains two features - * throughput (mb/s) and * latency (ms) of response of each server.</p>
<p>While your servers were operating, you collected <span class="math notranslate nohighlight">\(m=307\)</span> examples of how they were behaving, and thus have an unlabeled dataset <span class="math notranslate nohighlight">\(\{x^{(1)}, \ldots, x^{(m)}\}\)</span>. * You suspect that the vast majority of these examples are “normal” (non-anomalous) examples of the servers operating normally, but there might also be some examples of servers acting anomalously within this dataset.</p>
<p>You will use a Gaussian model to detect anomalous examples in your dataset. * You will first start on a 2D dataset that will allow you to visualize what the algorithm is doing. * On that dataset you will fit a Gaussian distribution and then find values that have very low probability and hence can be considered anomalies. * After that, you will apply the anomaly detection algorithm to a larger dataset with many dimensions.</p>
<p>### 2.2 Dataset</p>
<p>You will start by loading the dataset for this task. - The <code class="docutils literal notranslate"><span class="pre">load_data()</span></code> function shown below loads the data into the variables <code class="docutils literal notranslate"><span class="pre">X_train</span></code>, <code class="docutils literal notranslate"><span class="pre">X_val</span></code> and <code class="docutils literal notranslate"><span class="pre">y_val</span></code> - You will use <code class="docutils literal notranslate"><span class="pre">X_train</span></code> to fit a Gaussian distribution - You will use <code class="docutils literal notranslate"><span class="pre">X_val</span></code> and <code class="docutils literal notranslate"><span class="pre">y_val</span></code> as a cross validation set to select a threshold and determine anomalous vs normal examples</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the dataset</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">()</span>
</pre></div>
</div>
</div>
<section id="View-the-variables">
<h2>View the variables<a class="headerlink" href="#View-the-variables" title="Permalink to this heading"></a></h2>
<div class="line-block">
<div class="line">Let’s get more familiar with your dataset.</div>
<div class="line">- A good place to start is to just print out each variable and see what it contains.</div>
</div>
<p>The code below prints the first five elements of each of the variables</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display the first five elements of X_train</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The first 5 elements of X_train are:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">X_train</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The first 5 elements of X_train are:
 [[13.04681517 14.74115241]
 [13.40852019 13.7632696 ]
 [14.19591481 15.85318113]
 [14.91470077 16.17425987]
 [13.57669961 14.04284944]]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display the first five elements of X_val</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The first 5 elements of X_val are</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">X_val</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The first 5 elements of X_val are
 [[15.79025979 14.9210243 ]
 [13.63961877 15.32995521]
 [14.86589943 16.47386514]
 [13.58467605 13.98930611]
 [13.46404167 15.63533011]]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display the first five elements of y_val</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The first 5 elements of y_val are</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">y_val</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The first 5 elements of y_val are
 [0 0 0 0 0]
</pre></div></div>
</div>
</section>
<section id="Check-the-dimensions-of-your-variables">
<h2>Check the dimensions of your variables<a class="headerlink" href="#Check-the-dimensions-of-your-variables" title="Permalink to this heading"></a></h2>
<p>Another useful way to get familiar with your data is to view its dimensions.</p>
<p>The code below prints the shape of <code class="docutils literal notranslate"><span class="pre">X_train</span></code>, <code class="docutils literal notranslate"><span class="pre">X_val</span></code> and <code class="docutils literal notranslate"><span class="pre">y_val</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;The shape of X_train is:&#39;</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;The shape of X_val is:&#39;</span><span class="p">,</span> <span class="n">X_val</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;The shape of y_val is: &#39;</span><span class="p">,</span> <span class="n">y_val</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The shape of X_train is: (307, 2)
The shape of X_val is: (307, 2)
The shape of y_val is:  (307,)
</pre></div></div>
</div>
</section>
<section id="Visualize-your-data">
<h2>Visualize your data<a class="headerlink" href="#Visualize-your-data" title="Permalink to this heading"></a></h2>
<p>Before starting on any task, it is often useful to understand the data by visualizing it. - For this dataset, you can use a scatter plot to visualize the data (<code class="docutils literal notranslate"><span class="pre">X_train</span></code>), since it has only two properties to plot (throughput and latency)</p>
<ul class="simple">
<li><p>Your plot should look similar to the one below <img alt="665d615f98be4693b869a6398f2f412b" class="no-scaled-link" src="../../../../../_images/figure1.png" style="width: 500px; height: 500px;" /></p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a scatter plot of the data. To change the markers to blue &quot;x&quot;,</span>
<span class="c1"># we used the &#39;marker&#39; and &#39;c&#39; parameters</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_train</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="c1"># Set the title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;The first dataset&quot;</span><span class="p">)</span>
<span class="c1"># Set the y-axis label</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Throughput (mb/s)&#39;</span><span class="p">)</span>
<span class="c1"># Set the x-axis label</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Latency (ms)&#39;</span><span class="p">)</span>
<span class="c1"># Set axis range</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../../_images/source_files_Unsupervised_Learning_Recommenders_Reinforcement_Learning_week1_C3W1A_C3W1A2_C3_W1_Anomaly_Detection_12_0.png" src="../../../../../_images/source_files_Unsupervised_Learning_Recommenders_Reinforcement_Learning_week1_C3W1A_C3W1A2_C3_W1_Anomaly_Detection_12_0.png" />
</div>
</div>
<p>### 2.3 Gaussian distribution</p>
<p>To perform anomaly detection, you will first need to fit a model to the data’s distribution.</p>
<ul>
<li><p>Given a training set <span class="math notranslate nohighlight">\(\{x^{(1)}, ..., x^{(m)}\}\)</span> you want to estimate the Gaussian distribution for each of the features <span class="math notranslate nohighlight">\(x_i\)</span>.</p></li>
<li><p>Recall that the Gaussian distribution is given by</p>
<div class="math notranslate nohighlight">
\[p(x ; \mu,\sigma ^2) = \frac{1}{\sqrt{2 \pi \sigma ^2}}\exp^{ - \frac{(x - \mu)^2}{2 \sigma ^2} }\]</div>
<p>where <span class="math notranslate nohighlight">\(\mu\)</span> is the mean and <span class="math notranslate nohighlight">\(\sigma^2\)</span> controls the variance.</p>
</li>
<li><p>For each feature <span class="math notranslate nohighlight">\(i = 1\ldots n\)</span>, you need to find parameters <span class="math notranslate nohighlight">\(\mu_i\)</span> and <span class="math notranslate nohighlight">\(\sigma_i^2\)</span> that fit the data in the <span class="math notranslate nohighlight">\(i\)</span>-th dimension <span class="math notranslate nohighlight">\(\{x_i^{(1)}, ..., x_i^{(m)}\}\)</span> (the <span class="math notranslate nohighlight">\(i\)</span>-th dimension of each example).</p></li>
</ul>
<section id="2.2.1-Estimating-parameters-for-a-Gaussian">
<h3>2.2.1 Estimating parameters for a Gaussian<a class="headerlink" href="#2.2.1-Estimating-parameters-for-a-Gaussian" title="Permalink to this heading"></a></h3>
<p><strong>Implementation</strong>:</p>
<p>Your task is to complete the code in <code class="docutils literal notranslate"><span class="pre">estimate_gaussian</span></code> below.</p>
<p>### Exercise 1</p>
<p>Please complete the <code class="docutils literal notranslate"><span class="pre">estimate_gaussian</span></code> function below to calculate <code class="docutils literal notranslate"><span class="pre">mu</span></code> (mean for each feature in <code class="docutils literal notranslate"><span class="pre">X</span></code>)and <code class="docutils literal notranslate"><span class="pre">var</span></code> (variance for each feature in <code class="docutils literal notranslate"><span class="pre">X</span></code>).</p>
<p>You can estimate the parameters, (<span class="math notranslate nohighlight">\(\mu_i\)</span>, <span class="math notranslate nohighlight">\(\sigma_i^2\)</span>), of the <span class="math notranslate nohighlight">\(i\)</span>-th feature by using the following equations. To estimate the mean, you will use:</p>
<div class="math notranslate nohighlight">
\[\mu_i = \frac{1}{m} \sum_{j=1}^m x_i^{(j)}\]</div>
<p>and for the variance you will use:</p>
<div class="math notranslate nohighlight">
\[\sigma_i^2 = \frac{1}{m} \sum_{j=1}^m (x_i^{(j)} - \mu_i)^2\]</div>
<p>If you get stuck, you can check out the hints presented after the cell below to help you with the implementation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># UNQ_C1</span>
<span class="c1"># GRADED FUNCTION: estimate_gaussian</span>

<span class="k">def</span> <span class="nf">estimate_gaussian</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates mean and variance of all features</span>
<span class="sd">    in the dataset</span>

<span class="sd">    Args:</span>
<span class="sd">        X (ndarray): (m, n) Data matrix</span>

<span class="sd">    Returns:</span>
<span class="sd">        mu (ndarray): (n,) Mean of all features</span>
<span class="sd">        var (ndarray): (n,) Variance of all features</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1">### START CODE HERE ###</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">m</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">m</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">X</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1">### END CODE HERE ###</span>

    <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span>
</pre></div>
</div>
</div>
<details><p>Click for hints</p>
<ul>
<li><p>You can implement this function in two ways:</p>
<ul>
<li><p>1 - by having two nested for loops - one looping over the <strong>columns</strong> of <code class="docutils literal notranslate"><span class="pre">X</span></code> (each feature) and then looping over each data point.</p></li>
<li><p>2 - in a vectorized manner by using <code class="docutils literal notranslate"><span class="pre">np.sum()</span></code> with <code class="docutils literal notranslate"><span class="pre">axis</span> <span class="pre">=</span> <span class="pre">0</span></code> parameter (since we want the sum for each column)</p></li>
<li><p>Here’s how you can structure the overall implementation of this function for the vectorized implementation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">estimate_gaussian</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
  <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>

  <span class="c1">### START CODE HERE ###</span>
  <span class="n">mu</span> <span class="o">=</span> <span class="c1"># Your code here to calculate the mean of every feature</span>
  <span class="n">var</span> <span class="o">=</span> <span class="c1"># Your code here to calculate the variance of every feature</span>
  <span class="c1">### END CODE HERE ###</span>

  <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span>
</pre></div>
</div>
</li>
</ul>
<p>If you’re still stuck, you can check the hints presented below to figure out how to calculate <code class="docutils literal notranslate"><span class="pre">mu</span></code> and <code class="docutils literal notranslate"><span class="pre">var</span></code>.</p>
<details><p>Hint to calculate mu     You can use np.sum to with <code class="docutils literal notranslate"><span class="pre">axis</span> <span class="pre">=</span> <span class="pre">0</span></code> parameter to get the sum for each column of an array</p>
<details><p>    More hints to calculate mu     You can compute mu as mu = 1 / m * np.sum(X, axis = 0)</p>
</details></details><details><p>Hint to calculate var     You can use np.sum to with <code class="docutils literal notranslate"><span class="pre">axis</span> <span class="pre">=</span> <span class="pre">0</span></code> parameter to get the sum for each column of an array and **2 to get the square.</p>
<details><p>    More hints to calculate var     You can compute var as var = 1 / m * np.sum((X - mu) ** 2, axis = 0)</p>
</details></details></li>
</ul>
</details><p>You can check if your implementation is correct by running the following test code:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Estimate mean and variance of each feature</span>
<span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">estimate_gaussian</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean of each feature:&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Variance of each feature:&quot;</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>

<span class="c1"># UNIT TEST</span>
<span class="kn">from</span> <span class="nn">public_tests</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">estimate_gaussian_test</span><span class="p">(</span><span class="n">estimate_gaussian</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mean of each feature: [14.11222578 14.99771051]
Variance of each feature: [1.83263141 1.70974533]
<span class="ansi-green-intense-fg">All tests passed!</span>
</pre></div></div>
</div>
<p><strong>Expected Output</strong>:</p>
<table><tr><td><p>Mean of each feature:</p>
</td><td><p>[14.11222578 14.99771051]</p>
</td></tr><tr><td><p>Variance of each feature:</p>
</td><td><p>[1.83263141 1.70974533]</p>
</td></tr></table><p>Now that you have completed the code in <code class="docutils literal notranslate"><span class="pre">estimate_gaussian</span></code>, we will visualize the contours of the fitted Gaussian distribution.</p>
<p>You should get a plot similar to the figure below. <img alt="32700d585d7749b9ba639f6f3e4f7062" class="no-scaled-link" src="../../../../../_images/figure2.png" style="width: 500px; height: 500px;" /></p>
<p>From your plot you can see that most of the examples are in the region with the highest probability, while the anomalous examples are in the regions with lower probabilities.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns the density of the multivariate normal</span>
<span class="c1"># at each data point (row) of X_train</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">multivariate_gaussian</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>

<span class="c1">#Plotting code</span>
<span class="n">visualize_fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../../_images/source_files_Unsupervised_Learning_Recommenders_Reinforcement_Learning_week1_C3W1A_C3W1A2_C3_W1_Anomaly_Detection_21_0.png" src="../../../../../_images/source_files_Unsupervised_Learning_Recommenders_Reinforcement_Learning_week1_C3W1A_C3W1A2_C3_W1_Anomaly_Detection_21_0.png" />
</div>
</div>
</section>
<section id="2.2.2-Selecting-the-threshold-\epsilon">
<h3>2.2.2 Selecting the threshold <span class="math notranslate nohighlight">\(\epsilon\)</span><a class="headerlink" href="#2.2.2-Selecting-the-threshold-\epsilon" title="Permalink to this heading"></a></h3>
<p>Now that you have estimated the Gaussian parameters, you can investigate which examples have a very high probability given this distribution and which examples have a very low probability.</p>
<ul class="simple">
<li><p>The low probability examples are more likely to be the anomalies in our dataset.</p></li>
<li><p>One way to determine which examples are anomalies is to select a threshold based on a cross validation set.</p></li>
</ul>
<p>In this section, you will complete the code in <code class="docutils literal notranslate"><span class="pre">select_threshold</span></code> to select the threshold <span class="math notranslate nohighlight">\(\varepsilon\)</span> using the <span class="math notranslate nohighlight">\(F_1\)</span> score on a cross validation set.</p>
<ul class="simple">
<li><p>For this, we will use a cross validation set <span class="math notranslate nohighlight">\(\{(x_{\rm cv}^{(1)}, y_{\rm cv}^{(1)}),\ldots, (x_{\rm cv}^{(m_{\rm cv})}, y_{\rm cv}^{(m_{\rm cv})})\}\)</span>, where the label <span class="math notranslate nohighlight">\(y=1\)</span> corresponds to an anomalous example, and <span class="math notranslate nohighlight">\(y=0\)</span> corresponds to a normal example.</p></li>
<li><p>For each cross validation example, we will compute <span class="math notranslate nohighlight">\(p(x_{\rm cv}^{(i)})\)</span>. The vector of all of these probabilities <span class="math notranslate nohighlight">\(p(x_{\rm cv}^{(1)}), \ldots, p(x_{\rm cv}^{(m_{\rm cv)}})\)</span> is passed to <code class="docutils literal notranslate"><span class="pre">select_threshold</span></code> in the vector <code class="docutils literal notranslate"><span class="pre">p_val</span></code>.</p></li>
<li><p>The corresponding labels <span class="math notranslate nohighlight">\(y_{\rm cv}^{(1)}, \ldots, y_{\rm cv}^{(m_{\rm cv)}}\)</span> is passed to the same function in the vector <code class="docutils literal notranslate"><span class="pre">y_val</span></code>.</p></li>
</ul>
<p>### Exercise 2 Please complete the <code class="docutils literal notranslate"><span class="pre">select_threshold</span></code> function below to find the best threshold to use for selecting outliers based on the results from a validation set (<code class="docutils literal notranslate"><span class="pre">p_val</span></code>) and the ground truth (<code class="docutils literal notranslate"><span class="pre">y_val</span></code>).</p>
<ul>
<li><p>In the provided code <code class="docutils literal notranslate"><span class="pre">select_threshold</span></code>, there is already a loop that will try many different values of <span class="math notranslate nohighlight">\(\varepsilon\)</span> and select the best <span class="math notranslate nohighlight">\(\varepsilon\)</span> based on the <span class="math notranslate nohighlight">\(F_1\)</span> score.</p></li>
<li><p>You need implement code to calculate the F1 score from choosing <code class="docutils literal notranslate"><span class="pre">epsilon</span></code> as the threshold and place the value in <code class="docutils literal notranslate"><span class="pre">F1</span></code>.</p>
<ul>
<li><p>Recall that if an example <span class="math notranslate nohighlight">\(x\)</span> has a low probability <span class="math notranslate nohighlight">\(p(x) &lt; \varepsilon\)</span>, then it is classified as an anomaly.</p></li>
<li><p>Then, you can compute precision and recall by:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{aligned}
 prec&amp;=&amp;\frac{tp}{tp+fp}\\
 rec&amp;=&amp;\frac{tp}{tp+fn},
 \end{aligned}\end{split}\]</div>
<p>where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(tp\)</span> is the number of true positives: the ground truth label says it’s an anomaly and our algorithm correctly classified it as an anomaly.</p></li>
<li><p><span class="math notranslate nohighlight">\(fp\)</span> is the number of false positives: the ground truth label says it’s not an anomaly, but our algorithm incorrectly classified it as an anomaly.</p></li>
<li><p><span class="math notranslate nohighlight">\(fn\)</span> is the number of false negatives: the ground truth label says it’s an anomaly, but our algorithm incorrectly classified it as not being anomalous.</p></li>
</ul>
</li>
<li><p>The <span class="math notranslate nohighlight">\(F_1\)</span> score is computed using precision (<span class="math notranslate nohighlight">\(prec\)</span>) and recall (<span class="math notranslate nohighlight">\(rec\)</span>) as follows:</p>
<div class="math notranslate nohighlight">
\[F_1 = \frac{2\cdot prec \cdot rec}{prec + rec}\]</div>
</li>
</ul>
</li>
</ul>
<p><strong>Implementation Note:</strong> In order to compute <span class="math notranslate nohighlight">\(tp\)</span>, <span class="math notranslate nohighlight">\(fp\)</span> and <span class="math notranslate nohighlight">\(fn\)</span>, you may be able to use a vectorized implementation rather than loop over all the examples.</p>
<p>If you get stuck, you can check out the hints presented after the cell below to help you with the implementation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># UNQ_C2</span>
<span class="c1"># GRADED FUNCTION: select_threshold</span>

<span class="k">def</span> <span class="nf">select_threshold</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">p_val</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds the best threshold to use for selecting outliers</span>
<span class="sd">    based on the results from a validation set (p_val)</span>
<span class="sd">    and the ground truth (y_val)</span>

<span class="sd">    Args:</span>
<span class="sd">        y_val (ndarray): Ground truth on validation set</span>
<span class="sd">        p_val (ndarray): Results on validation set</span>

<span class="sd">    Returns:</span>
<span class="sd">        epsilon (float): Threshold chosen</span>
<span class="sd">        F1 (float):      F1 score by choosing epsilon as threshold</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">best_epsilon</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">best_F1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">F1</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">step_size</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">p_val</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">p_val</span><span class="p">))</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="k">for</span> <span class="n">epsilon</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">p_val</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">p_val</span><span class="p">),</span> <span class="n">step_size</span><span class="p">):</span>

        <span class="c1">### START CODE HERE ###</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_val</span> <span class="o">&lt;</span> <span class="n">epsilon</span><span class="p">)</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">predictions</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_val</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">predictions</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_val</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">predictions</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">prec</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span>
        <span class="n">rec</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>
        <span class="n">F1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">prec</span> <span class="o">*</span> <span class="n">rec</span> <span class="o">/</span> <span class="p">(</span><span class="n">prec</span> <span class="o">+</span> <span class="n">rec</span><span class="p">)</span>
        <span class="c1">### END CODE HERE ###</span>

        <span class="k">if</span> <span class="n">F1</span> <span class="o">&gt;</span> <span class="n">best_F1</span><span class="p">:</span>
            <span class="n">best_F1</span> <span class="o">=</span> <span class="n">F1</span>
            <span class="n">best_epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>

    <span class="k">return</span> <span class="n">best_epsilon</span><span class="p">,</span> <span class="n">best_F1</span>
</pre></div>
</div>
</div>
<details><p>Click for hints</p>
<ul>
<li><div class="line-block">
<div class="line">Here’s how you can structure the overall implementation of this function for the vectorized implementation: ```python</div>
<div class="line">def select_threshold(y_val, p_val): best_epsilon = 0 best_F1 = 0 F1 = 0</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>step_size = (max(p_val) - min(p_val)) / 1000

for epsilon in np.arange(min(p_val), max(p_val), step_size):

    ### START CODE HERE ###
    predictions = # Your code here to calculate predictions for each example using epsilon as threshold

    tp = # Your code here to calculate number of true positives
    fp = # Your code here to calculate number of false positives
    fn = # Your code here to calculate number of false negatives

    prec = # Your code here to calculate precision
    rec = # Your code here to calculate recall

    F1 = # Your code here to calculate F1
    ### END CODE HERE ###

    if F1 &gt; best_F1:
        best_F1 = F1
        best_epsilon = epsilon

return best_epsilon, best_F1
</pre></div>
</div>
<p>```</p>
<p>If you’re still stuck, you can check the hints presented below to figure out how to calculate each variable.</p>
<details><p>Hint to calculate predictions     If an example 𝑥 has a low probability <span class="math notranslate nohighlight">\(p(x) &lt; \epsilon\)</span> , then it is classified as an anomaly. To get predictions for each example (0/ False for normal and 1/True for anomaly), you can use predictions = (p_val &lt; epsilon)</p>
</details><details><p>Hint to calculate tp, fp, fn</p>
<ul><li><p>If you have several binary values in an <span class="math notranslate nohighlight">\(n\)</span>-dimensional binary vector, you can find out how many values in this vector are 0 by using: <code class="docutils literal notranslate"><span class="pre">np.sum(v</span> <span class="pre">==</span> <span class="pre">0)</span></code></p>
</li><li><p>You can also apply a logical <em>and</em> operator to such binary vectors. For instance, <code class="docutils literal notranslate"><span class="pre">predictions</span></code> is a binary vector of the size of your number of cross validation set, where the <span class="math notranslate nohighlight">\(i\)</span>-th element is 1 if your algorithm considers <span class="math notranslate nohighlight">\(x_{\rm cv}^{(i)}\)</span> an anomaly, and 0 otherwise.</p>
</li><li><div class="line-block">
<div class="line">You can then, for example, compute the number of false positives using:</div>
<div class="line">fp = sum((predictions == 1) &amp; (y_val == 0)).</div>
</div>
</li></ul><details><p>    More hints to calculate tp, fn</p>
<ul><li><p>You can compute tp as tp = np.sum((predictions == 1) &amp; (y_val == 1))</p>
</li><li><p>You can compute tn as fn = np.sum((predictions == 0) &amp; (y_val == 1))</p>
</li></ul></details></details><details><p>Hint to calculate precision     You can calculate precision as prec = tp / (tp + fp)</p>
</details><details><p>Hint to calculate recall     You can calculate recall as rec = tp / (tp + fn)</p>
</details><details><p>Hint to calculate F1     You can calculate F1 as F1 = 2 * prec * rec / (prec + rec)</p>
</details></li>
</ul>
</details><p>You can check your implementation using the code below</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_val</span> <span class="o">=</span> <span class="n">multivariate_gaussian</span><span class="p">(</span><span class="n">X_val</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
<span class="n">epsilon</span><span class="p">,</span> <span class="n">F1</span> <span class="o">=</span> <span class="n">select_threshold</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">p_val</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Best epsilon found using cross-validation: </span><span class="si">%e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">epsilon</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Best F1 on Cross Validation Set: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">F1</span><span class="p">)</span>

<span class="c1"># UNIT TEST</span>
<span class="n">select_threshold_test</span><span class="p">(</span><span class="n">select_threshold</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Best epsilon found using cross-validation: 8.990853e-05
Best F1 on Cross Validation Set: 0.875000
<span class="ansi-green-intense-fg">All tests passed!</span>
</pre></div></div>
</div>
<p><strong>Expected Output</strong>:</p>
<table><tr><td><p>Best epsilon found using cross-validation:</p>
</td><td><p>8.99e-05</p>
</td></tr><tr><td><p>Best F1 on Cross Validation Set:</p>
</td><td><p>0.875</p>
</td></tr></table><p>Now we will run your anomaly detection code and circle the anomalies in the plot (Figure 3 below).</p>
<p><img alt="f9abe18218984dedadf5473ed165dfde" class="no-scaled-link" src="../../../../../_images/figure3.png" style="width: 500px; height: 500px;" /></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find the outliers in the training set</span>
<span class="n">outliers</span> <span class="o">=</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">epsilon</span>

<span class="c1"># Visualize the fit</span>
<span class="n">visualize_fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>

<span class="c1"># Draw a red circle around those outliers</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">outliers</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_train</span><span class="p">[</span><span class="n">outliers</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span>
         <span class="n">markersize</span><span class="o">=</span> <span class="mi">10</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x7f9000717290&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../../_images/source_files_Unsupervised_Learning_Recommenders_Reinforcement_Learning_week1_C3W1A_C3W1A2_C3_W1_Anomaly_Detection_30_1.png" src="../../../../../_images/source_files_Unsupervised_Learning_Recommenders_Reinforcement_Learning_week1_C3W1A_C3W1A2_C3_W1_Anomaly_Detection_30_1.png" />
</div>
</div>
<p>### 2.4 High dimensional dataset</p>
<p>Now, we will run the anomaly detection algorithm that you implemented on a more realistic and much harder dataset.</p>
<p>In this dataset, each example is described by 11 features, capturing many more properties of your compute servers.</p>
<p>Let’s start by loading the dataset.</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">load_data()</span></code> function shown below loads the data into variables <code class="docutils literal notranslate"><span class="pre">X_train_high</span></code>, <code class="docutils literal notranslate"><span class="pre">X_val_high</span></code> and <code class="docutils literal notranslate"><span class="pre">y_val_high</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">_high</span></code> is meant to distinguish these variables from the ones used in the previous part</p></li>
<li><p>We will use <code class="docutils literal notranslate"><span class="pre">X_train_high</span></code> to fit Gaussian distribution</p></li>
<li><p>We will use <code class="docutils literal notranslate"><span class="pre">X_val_high</span></code> and <code class="docutils literal notranslate"><span class="pre">y_val_high</span></code> as a cross validation set to select a threshold and determine anomalous vs normal examples</p></li>
</ul>
</li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the dataset</span>
<span class="n">X_train_high</span><span class="p">,</span> <span class="n">X_val_high</span><span class="p">,</span> <span class="n">y_val_high</span> <span class="o">=</span> <span class="n">load_data_multi</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="id1">
<h2>Check the dimensions of your variables<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
<p>Let’s check the dimensions of these new variables to become familiar with the data</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;The shape of X_train_high is:&#39;</span><span class="p">,</span> <span class="n">X_train_high</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;The shape of X_val_high is:&#39;</span><span class="p">,</span> <span class="n">X_val_high</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;The shape of y_val_high is: &#39;</span><span class="p">,</span> <span class="n">y_val_high</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The shape of X_train_high is: (1000, 11)
The shape of X_val_high is: (100, 11)
The shape of y_val_high is:  (100,)
</pre></div></div>
</div>
</section>
<section id="Anomaly-detection">
<h2>Anomaly detection<a class="headerlink" href="#Anomaly-detection" title="Permalink to this heading"></a></h2>
<p>Now, let’s run the anomaly detection algorithm on this new dataset.</p>
<p>The code below will use your code to * Estimate the Gaussian parameters (<span class="math notranslate nohighlight">\(\mu_i\)</span> and <span class="math notranslate nohighlight">\(\sigma_i^2\)</span>) * Evaluate the probabilities for both the training data <code class="docutils literal notranslate"><span class="pre">X_train_high</span></code> from which you estimated the Gaussian parameters, as well as for the the cross-validation set <code class="docutils literal notranslate"><span class="pre">X_val_high</span></code>. * Finally, it will use <code class="docutils literal notranslate"><span class="pre">select_threshold</span></code> to find the best threshold <span class="math notranslate nohighlight">\(\varepsilon\)</span>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply the same steps to the larger dataset</span>

<span class="c1"># Estimate the Gaussian parameters</span>
<span class="n">mu_high</span><span class="p">,</span> <span class="n">var_high</span> <span class="o">=</span> <span class="n">estimate_gaussian</span><span class="p">(</span><span class="n">X_train_high</span><span class="p">)</span>

<span class="c1"># Evaluate the probabilites for the training set</span>
<span class="n">p_high</span> <span class="o">=</span> <span class="n">multivariate_gaussian</span><span class="p">(</span><span class="n">X_train_high</span><span class="p">,</span> <span class="n">mu_high</span><span class="p">,</span> <span class="n">var_high</span><span class="p">)</span>

<span class="c1"># Evaluate the probabilites for the cross validation set</span>
<span class="n">p_val_high</span> <span class="o">=</span> <span class="n">multivariate_gaussian</span><span class="p">(</span><span class="n">X_val_high</span><span class="p">,</span> <span class="n">mu_high</span><span class="p">,</span> <span class="n">var_high</span><span class="p">)</span>

<span class="c1"># Find the best threshold</span>
<span class="n">epsilon_high</span><span class="p">,</span> <span class="n">F1_high</span> <span class="o">=</span> <span class="n">select_threshold</span><span class="p">(</span><span class="n">y_val_high</span><span class="p">,</span> <span class="n">p_val_high</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Best epsilon found using cross-validation: </span><span class="si">%e</span><span class="s1">&#39;</span><span class="o">%</span> <span class="n">epsilon_high</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Best F1 on Cross Validation Set:  </span><span class="si">%f</span><span class="s1">&#39;</span><span class="o">%</span> <span class="n">F1_high</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;# Anomalies found: </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p_high</span> <span class="o">&lt;</span> <span class="n">epsilon_high</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Best epsilon found using cross-validation: 1.377229e-18
Best F1 on Cross Validation Set:  0.615385
# Anomalies found: 117
</pre></div></div>
</div>
<p><strong>Expected Output</strong>:</p>
<table><tr><td><p>Best epsilon found using cross-validation:</p>
</td><td><p>1.38e-18</p>
</td></tr><tr><td><p>Best F1 on Cross Validation Set:</p>
</td><td><p>0.615385</p>
</td></tr><tr><td><p># anomalies found:</p>
</td><td><p>117</p>
</td></tr></table></section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Andrew Ng.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>